[tox]
envlist = py27,py36,static,pidiff

[testenv]
deps=-rtest-requirements.txt
commands=pytest -v {posargs}
whitelist_externals=sh

[testenv:py27]
deps=
  # Note: we need to explicitly list requirements.txt here
  # so it's processed at the same time as the constraints file
  -rrequirements.txt
  -rtest-requirements.txt

[testenv:static]
deps=
  pylint
commands=
  sh -c 'pylint-2 alt-src; test $(( $? & (1|2|4|32) )) = 0'

[testenv:cov]
deps=
  -rtest-requirements.txt
  pytest-cov
usedevelop=true
commands=
  pytest --cov-report=html --cov=pubtools {posargs}

[testenv:cov-travis]
passenv = TRAVIS TRAVIS_*
deps=
  -rtest-requirements.txt
  pytest-cov
  coveralls
usedevelop=true
commands=
  pytest --cov=pubtools {posargs}
  coveralls
